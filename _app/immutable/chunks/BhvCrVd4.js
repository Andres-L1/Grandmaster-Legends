var b=Object.defineProperty;var U=(n,i,a)=>i in n?b(n,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[i]=a;var A=(n,i,a)=>U(n,typeof i!="symbol"?i+"":i,a);import{O as L,T as B,ae as F,y as c,af as _,ag as P,ah as N,_ as v,Z as z,Q as j,ai as u,aj as D}from"./DcEHMtQ0.js";import{a as l}from"./M31wldXr.js";function H(n,i){let a=null,e=c;var s;if(c){a=j;for(var t=_(document.head);t!==null&&(t.nodeType!==P||t.data!==n);)t=N(t);if(t===null)v(!1);else{var r=N(t);t.remove(),z(r)}}c||(s=document.head.appendChild(L()));try{B(()=>i(s),F)}finally{e&&(v(!0),z(a))}}const M="https://lichess.org/api",G=36e5,w={DrNykterstein:"Magnus Carlsen",RebeccaHarris:"Daniel Naroditsky",Penguingim1:"Andrew Tang",Hikaru:"Hikaru Nakamura",LachesisQ:"Ian Nepomniachtchi",FabianoCaruana:"Fabiano Caruana",WesleySo:"Wesley So",Levon:"Levon Aronian",MVL:"Maxime Vachier-Lagrave",AnishGiri:"Anish Giri",Vishy:"Viswanathan Anand",alireza2003:"Alireza Firouzja",Firouzja2003:"Alireza Firouzja",Bigfish1995:"Vladimir Fedoseev",Zhigalko_Sergei:"Sergei Zhigalko",Konavets:"Savenkov Konstantin","Night-King96":"Oleksandr Bortnyk",nihalsarin2004:"Nihal Sarin",RaunakSadhwani2005:"Raunak Sadhwani",Praggnanandhaa:"Rameshbabu Praggnanandhaa",Gukesh:"Dommaraju Gukesh",ArjunErigaisi:"Arjun Erigaisi",ViditS:"Vidit Gujrathi","S-L-Narayanan":"S.L. Narayanan",Aravindh:"Aravindh Chithambaram","yuuki-asuna":"Jeffrey Xiong",Haest:"Nils Grandelius",muisback:"Muhammed Batuhan Dastan",Mutdpro:"Alan Pichot",FeegLood:"Sam Sevian",benefactor2018:"Alireza Firouzja"};class E{constructor(){A(this,"cache",null)}async getTopPlayers(i=500){if(this.cache&&Date.now()-this.cache.timestamp<G)return this.cache.players.slice(0,i);if(typeof localStorage<"u"){const a=localStorage.getItem("gf_api_players_cache");if(a){const e=JSON.parse(a);if(Date.now()-e.timestamp<G)return this.cache=e,e.players.slice(0,i)}}try{const a=await fetch(`${M}/player/top/${i}/classical`,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error(`Lichess API error: ${a.status}`);const e=await a.json(),s=this.transformPlayers(e.users||[]);return this.cache={players:s,timestamp:Date.now()},typeof localStorage<"u"&&localStorage.setItem("gf_api_players_cache",JSON.stringify(this.cache)),s}catch(a){return console.error("Failed to fetch Lichess players:",a),this.getFallbackPlayers()}}transformPlayers(i){return i.map((a,e)=>{var o,p,g,d,m,f,y,S,k,R;const s=((p=(o=a.perfs)==null?void 0:o.classical)==null?void 0:p.rating)||2500,t=e+1;let r;return w[a.username]?r=w[a.username]:(g=a.profile)!=null&&g.firstName&&((d=a.profile)!=null&&d.lastName)?r=`${a.profile.firstName} ${a.profile.lastName}`:(m=a.profile)!=null&&m.firstName?r=a.profile.firstName:r=a.username,a.title&&(r=`${a.title} ${r}`),{id:a.id,username:a.username,name:r,title:a.title,rating:s,ratingRapid:((y=(f=a.perfs)==null?void 0:f.rapid)==null?void 0:y.rating)||0,ratingBlitz:((k=(S=a.perfs)==null?void 0:S.blitz)==null?void 0:k.rating)||0,price:this.calculatePrice(s,t),position:t,photoUrl:`https://lichess1.org/assets/logo/lichess-pad-${a.username}.png`,country:(R=a.profile)==null?void 0:R.country}})}calculatePrice(i,a){let e;return a<=10?e=25e6-(a-1)*1e6:a<=50?e=15e6-(a-10)/40*7e6:a<=100?e=8e6-(a-50)/50*3e6:a<=200?e=5e6-(a-100)/100*2e6:e=3e6-(a-200)/300*2e6,e=Math.max(1e6,e),Math.round(e/1e5)*1e5}getFallbackPlayers(){return[{id:"magnuscarlsen",username:"DrNykterstein",name:"GM Magnus Carlsen",rating:2830,ratingRapid:2820,ratingBlitz:2890,price:25e6,position:1,photoUrl:"",country:"NO"},{id:"fabianocaruana",username:"FabianoCaruana",name:"GM Fabiano Caruana",rating:2805,ratingRapid:2750,ratingBlitz:2800,price:24e6,position:2,photoUrl:"",country:"US"},{id:"dingliren",username:"DingLiren",name:"GM Ding Liren",rating:2780,ratingRapid:2740,ratingBlitz:2790,price:23e6,position:3,photoUrl:"",country:"CN"},{id:"iannepo",username:"lachesisQ",name:"GM Ian Nepomniachtchi",rating:2770,ratingRapid:2760,ratingBlitz:2780,price:22e6,position:4,photoUrl:"",country:"RU"},{id:"hikarunakamura",username:"Hikaru",name:"GM Hikaru Nakamura",rating:2765,ratingRapid:2750,ratingBlitz:2900,price:21e6,position:5,photoUrl:"",country:"US"},{id:"alirezafirouzja",username:"Firouzja2003",name:"GM Alireza Firouzja",rating:2760,ratingRapid:2730,ratingBlitz:2880,price:2e7,position:6,photoUrl:"",country:"FR"},{id:"wesleyso",username:"WesleySo",name:"GM Wesley So",rating:2755,ratingRapid:2760,ratingBlitz:2770,price:19e6,position:7,photoUrl:"",country:"US"},{id:"levonaronian",username:"Levon",name:"GM Levon Aronian",rating:2750,ratingRapid:2740,ratingBlitz:2760,price:18e6,position:8,photoUrl:"",country:"US"},{id:"mvl",username:"MVL",name:"GM Maxime Vachier-Lagrave",rating:2745,ratingRapid:2760,ratingBlitz:2780,price:17e6,position:9,photoUrl:"",country:"FR"},{id:"anishgiri",username:"AnishGiri",name:"GM Anish Giri",rating:2740,ratingRapid:2710,ratingBlitz:2750,price:16e6,position:10,photoUrl:"",country:"NL"},{id:"vishy",username:"Vishy",name:"GM Viswanathan Anand",rating:2735,ratingRapid:2750,ratingBlitz:2730,price:14e6,position:11,photoUrl:"",country:"IN"},{id:"shakhriyar",username:"Shakhriyar",name:"GM Shakhriyar Mamedyarov",rating:2730,ratingRapid:2720,ratingBlitz:2740,price:13e6,position:12,photoUrl:"",country:"AZ"},{id:"teimour",username:"Teimour",name:"GM Teimour Radjabov",rating:2725,ratingRapid:2710,ratingBlitz:2720,price:12e6,position:13,photoUrl:"",country:"AZ"},{id:"grischuk",username:"Grischuk",name:"GM Alexander Grischuk",rating:2720,ratingRapid:2730,ratingBlitz:2750,price:11e6,position:14,photoUrl:"",country:"RU"},{id:"rapport",username:"RichardRapport",name:"GM Richard Rapport",rating:2715,ratingRapid:2740,ratingBlitz:2690,price:1e7,position:15,photoUrl:"",country:"RO"}]}clearCache(){this.cache=null}async getRecentGames(i,a=5){try{const e=await fetch(`${M}/games/user/${i}?max=${a}&rated=true&perfType=blitz,rapid,classical`,{headers:{Accept:"application/x-ndjson"}});if(!e.ok)return[];const s=await e.text();return s?s.trim().split(`
`).map(t=>{try{const r=JSON.parse(t);return{winner:r.winner,status:r.status,players:r.players}}catch{return null}}).filter(t=>t!==null):[]}catch(e){return console.error(`Error fetching games for ${i}`,e),[]}}}const I=new E,h=u([]),C=u(!0);I.getTopPlayers(500).then(n=>{h.set(n),C.set(!1)}).catch(n=>{console.error("Failed to load players:",n),C.set(!1)});function $(){const n=l.getCollection(),{subscribe:i,set:a,update:e}=u(n);return{subscribe:i,addCard:s=>{let t=!1;return e(r=>{if(!r.includes(s)){t=!0;const o=[...r,s];return l.saveCollection(o),o}return r}),{isNew:t}},removeCard:s=>{e(t=>{const r=t.filter(o=>o!==s);return l.saveCollection(r),r})},reset:()=>{a([]),l.saveCollection([])}}}const x=$();D([x,h],([n,i])=>i.filter(a=>n.includes(a.id)));const W=h;export{W as a,x as c,H as h,I as l,C as p};
