var z=Object.defineProperty;var k=(n,a,e)=>a in n?z(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e;var N=(n,a,e)=>k(n,typeof a!="symbol"?a+"":a,e);import{R as y,Q as M,T as f}from"./I7kW3HN8.js";const o={USER:"gf_user",OWNED_PLAYERS:"gf_owned_players",PLAYER_CLAUSES:"gf_player_clauses",CURRENT_TEAM:"gf_current_team",CAPTAIN:"gf_captain"},C={username:"Chess Fan",budget:1e8,totalPoints:0,seenOnboarding:!1};class G{getUser(){const a=localStorage.getItem(o.USER);if(a){const e=JSON.parse(a);return e.seenOnboarding===void 0&&(e.seenOnboarding=!1),e}return C}saveUser(a){localStorage.setItem(o.USER,JSON.stringify(a))}getOwnedPlayerIds(){const a=localStorage.getItem(o.OWNED_PLAYERS);return a?JSON.parse(a):[]}saveOwnedPlayerIds(a){localStorage.setItem(o.OWNED_PLAYERS,JSON.stringify(a))}getPlayerClauses(){const a=localStorage.getItem(o.PLAYER_CLAUSES);return a?JSON.parse(a):{}}savePlayerClauses(a){localStorage.setItem(o.PLAYER_CLAUSES,JSON.stringify(a))}getCurrentTeam(){const a=localStorage.getItem(o.CURRENT_TEAM);return a?JSON.parse(a):[]}saveCurrentTeam(a){localStorage.setItem(o.CURRENT_TEAM,JSON.stringify(a.slice(0,3)))}getCaptain(){return localStorage.getItem(o.CAPTAIN)}saveCaptain(a){a?localStorage.setItem(o.CAPTAIN,a):localStorage.removeItem(o.CAPTAIN)}resetAll(){localStorage.removeItem(o.USER),localStorage.removeItem(o.OWNED_PLAYERS),localStorage.removeItem(o.PLAYER_CLAUSES),localStorage.removeItem(o.CURRENT_TEAM),localStorage.removeItem(o.CAPTAIN)}initialize(){localStorage.getItem(o.USER)||this.saveUser(C),localStorage.getItem(o.OWNED_PLAYERS)||this.saveOwnedPlayerIds([]),localStorage.getItem(o.PLAYER_CLAUSES)||this.savePlayerClauses({}),localStorage.getItem(o.CURRENT_TEAM)||this.saveCurrentTeam([])}}const u=new G;u.initialize();function I(){const n=u.getUser(),{subscribe:a,set:e,update:r}=y(n);return{subscribe:a,updateBudget:t=>{r(s=>{const i={...s,budget:s.budget+t};return u.saveUser(i),i})},addPoints:t=>{r(s=>{const i={...s,totalPoints:s.totalPoints+t};return u.saveUser(i),i})},setUsername:t=>{r(s=>{const i={...s,username:t};return u.saveUser(i),i})},completeOnboarding:()=>{r(t=>{const s={...t,seenOnboarding:!0};return u.saveUser(s),s})},reset:()=>{const t={username:"Guest Player",budget:1e8,totalPoints:0,seenOnboarding:!1};e(t),u.saveUser(t)}}}const S=I(),E="https://lichess.org/api",b=36e5,L={DrNykterstein:"Magnus Carlsen",RebeccaHarris:"Daniel Naroditsky",Penguingim1:"Andrew Tang",Hikaru:"Hikaru Nakamura",LachesisQ:"Ian Nepomniachtchi",FabianoCaruana:"Fabiano Caruana",WesleySo:"Wesley So",Levon:"Levon Aronian",MVL:"Maxime Vachier-Lagrave",AnishGiri:"Anish Giri",Vishy:"Viswanathan Anand",alireza2003:"Alireza Firouzja",Firouzja2003:"Alireza Firouzja",Bigfish1995:"Vladimir Fedoseev",Zhigalko_Sergei:"Sergei Zhigalko",Konavets:"Savenkov Konstantin","Night-King96":"Oleksandr Bortnyk",nihalsarin2004:"Nihal Sarin",RaunakSadhwani2005:"Raunak Sadhwani",Praggnanandhaa:"Rameshbabu Praggnanandhaa",Gukesh:"Dommaraju Gukesh",ArjunErigaisi:"Arjun Erigaisi",ViditS:"Vidit Gujrathi","S-L-Narayanan":"S.L. Narayanan",Aravindh:"Aravindh Chithambaram","yuuki-asuna":"Jeffrey Xiong",Haest:"Nils Grandelius",muisback:"Muhammed Batuhan Dastan",Mutdpro:"Alan Pichot",FeegLood:"Sam Sevian",benefactor2018:"Alireza Firouzja"};class T{constructor(){N(this,"cache",null)}async getTopPlayers(a=500){if(this.cache&&Date.now()-this.cache.timestamp<b)return this.cache.players.slice(0,a);if(typeof localStorage<"u"){const e=localStorage.getItem("gf_api_players_cache");if(e){const r=JSON.parse(e);if(Date.now()-r.timestamp<b)return this.cache=r,r.players.slice(0,a)}}try{const e=await fetch(`${E}/player/top/${a}/classical`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`Lichess API error: ${e.status}`);const r=await e.json(),t=this.transformPlayers(r.users||[]);return this.cache={players:t,timestamp:Date.now()},typeof localStorage<"u"&&localStorage.setItem("gf_api_players_cache",JSON.stringify(this.cache)),t}catch(e){return console.error("Failed to fetch Lichess players:",e),this.getFallbackPlayers()}}transformPlayers(a){return a.map((e,r)=>{var l,c,g,d,m,A,P,R,U,v;const t=((c=(l=e.perfs)==null?void 0:l.classical)==null?void 0:c.rating)||2500,s=r+1;let i;return L[e.username]?i=L[e.username]:(g=e.profile)!=null&&g.firstName&&((d=e.profile)!=null&&d.lastName)?i=`${e.profile.firstName} ${e.profile.lastName}`:(m=e.profile)!=null&&m.firstName?i=e.profile.firstName:i=e.username,e.title&&(i=`${e.title} ${i}`),{id:e.id,username:e.username,name:i,title:e.title,rating:t,ratingRapid:((P=(A=e.perfs)==null?void 0:A.rapid)==null?void 0:P.rating)||0,ratingBlitz:((U=(R=e.perfs)==null?void 0:R.blitz)==null?void 0:U.rating)||0,price:this.calculatePrice(t,s),position:s,photoUrl:`https://lichess1.org/assets/logo/lichess-pad-${e.username}.png`,country:(v=e.profile)==null?void 0:v.country}})}calculatePrice(a,e){let r;return e<=10?r=25e6-(e-1)*1e6:e<=50?r=15e6-(e-10)/40*7e6:e<=100?r=8e6-(e-50)/50*3e6:e<=200?r=5e6-(e-100)/100*2e6:r=3e6-(e-200)/300*2e6,r=Math.max(1e6,r),Math.round(r/1e5)*1e5}getFallbackPlayers(){return[{id:"magnuscarlsen",username:"DrNykterstein",name:"GM Magnus Carlsen",rating:2830,ratingRapid:2820,ratingBlitz:2890,price:25e6,position:1,photoUrl:"",country:"NO"},{id:"fabianocaruana",username:"FabianoCaruana",name:"GM Fabiano Caruana",rating:2805,ratingRapid:2750,ratingBlitz:2800,price:24e6,position:2,photoUrl:"",country:"US"},{id:"dingliren",username:"DingLiren",name:"GM Ding Liren",rating:2780,ratingRapid:2740,ratingBlitz:2790,price:23e6,position:3,photoUrl:"",country:"CN"},{id:"iannepo",username:"lachesisQ",name:"GM Ian Nepomniachtchi",rating:2770,ratingRapid:2760,ratingBlitz:2780,price:22e6,position:4,photoUrl:"",country:"RU"},{id:"hikarunakamura",username:"Hikaru",name:"GM Hikaru Nakamura",rating:2765,ratingRapid:2750,ratingBlitz:2900,price:21e6,position:5,photoUrl:"",country:"US"},{id:"alirezafirouzja",username:"Firouzja2003",name:"GM Alireza Firouzja",rating:2760,ratingRapid:2730,ratingBlitz:2880,price:2e7,position:6,photoUrl:"",country:"FR"},{id:"wesleyso",username:"WesleySo",name:"GM Wesley So",rating:2755,ratingRapid:2760,ratingBlitz:2770,price:19e6,position:7,photoUrl:"",country:"US"},{id:"levonaronian",username:"Levon",name:"GM Levon Aronian",rating:2750,ratingRapid:2740,ratingBlitz:2760,price:18e6,position:8,photoUrl:"",country:"US"},{id:"mvl",username:"MVL",name:"GM Maxime Vachier-Lagrave",rating:2745,ratingRapid:2760,ratingBlitz:2780,price:17e6,position:9,photoUrl:"",country:"FR"},{id:"anishgiri",username:"AnishGiri",name:"GM Anish Giri",rating:2740,ratingRapid:2710,ratingBlitz:2750,price:16e6,position:10,photoUrl:"",country:"NL"},{id:"vishy",username:"Vishy",name:"GM Viswanathan Anand",rating:2735,ratingRapid:2750,ratingBlitz:2730,price:14e6,position:11,photoUrl:"",country:"IN"},{id:"shakhriyar",username:"Shakhriyar",name:"GM Shakhriyar Mamedyarov",rating:2730,ratingRapid:2720,ratingBlitz:2740,price:13e6,position:12,photoUrl:"",country:"AZ"},{id:"teimour",username:"Teimour",name:"GM Teimour Radjabov",rating:2725,ratingRapid:2710,ratingBlitz:2720,price:12e6,position:13,photoUrl:"",country:"AZ"},{id:"grischuk",username:"Grischuk",name:"GM Alexander Grischuk",rating:2720,ratingRapid:2730,ratingBlitz:2750,price:11e6,position:14,photoUrl:"",country:"RU"},{id:"rapport",username:"RichardRapport",name:"GM Richard Rapport",rating:2715,ratingRapid:2740,ratingBlitz:2690,price:1e7,position:15,photoUrl:"",country:"RO"}]}clearCache(){this.cache=null}async getRecentGames(a,e=5){try{const r=await fetch(`${E}/games/user/${a}?max=${e}&rated=true&perfType=blitz,rapid,classical`,{headers:{Accept:"application/x-ndjson"}});if(!r.ok)return[];const t=await r.text();return t?t.trim().split(`
`).map(s=>{try{const i=JSON.parse(s);return{winner:i.winner,status:i.status,players:i.players}}catch{return null}}).filter(s=>s!==null):[]}catch(r){return console.error(`Error fetching games for ${a}`,r),[]}}}const w=new T,h=y([]),_=y(!0);w.getTopPlayers(500).then(n=>{h.set(n),_.set(!1)}).catch(n=>{console.error("Failed to load players:",n),_.set(!1)});function B(){const n=u.getPlayerClauses(),{subscribe:a,set:e,update:r}=y(n);return{subscribe:a,setClause:(t,s)=>{r(i=>{const l={...i,[t]:s};return u.savePlayerClauses(l),l})},removeClause:t=>{r(s=>{const{[t]:i,...l}=s;return u.savePlayerClauses(l),l})},reset:()=>{e({}),u.savePlayerClauses({})}}}const p=B();function F(){const n=u.getOwnedPlayerIds(),{subscribe:a,set:e,update:r}=y(n);return{subscribe:a,buyPlayer:(t,s)=>{let i={success:!1,message:""};const l=f(h);return r(c=>{const g=l.find(A=>A.id===t);if(!g)return i={success:!1,message:"Jugador no encontrado"},c;if(c.includes(t))return i={success:!1,message:"Ya tienes este jugador"},c;if(c.length>=15)return i={success:!1,message:"Roster completo (máximo 15 jugadores)"},c;if(f(S).budget<s)return i={success:!1,message:"Presupuesto insuficiente"},c;S.updateBudget(-s);const m=[...c,t];return u.saveOwnedPlayerIds(m),p.setClause(t,s),i={success:!0,message:`${g.name} fichado exitosamente`},m}),i},sellPlayer:t=>{let s={success:!1,message:""};const i=f(h);return r(l=>{if(!l.includes(t))return s={success:!1,message:"No tienes este jugador"},l;const c=i.find(m=>m.id===t);if(!c)return s={success:!1,message:"Jugador no encontrado"},l;const g=Math.floor(c.price*.8);S.updateBudget(g);const d=l.filter(m=>m!==t);return u.saveOwnedPlayerIds(d),p.removeClause(t),s={success:!0,message:`${c.name} vendido por ${(g/1e6).toFixed(0)}M`},d}),s},increaseClause:(t,s)=>{const l=f(p)[t]||0;if(s<=l)return{success:!1,message:"La nueva cláusula debe ser mayor que la actual"};const c=s-l,g=Math.floor(c*.1);return f(S).budget<g?{success:!1,message:`Necesitas ${(g/1e6).toFixed(1)}M para blindar (10% del aumento)`}:(S.updateBudget(-g),p.setClause(t,s),{success:!0,message:`Cláusula aumentada a ${(s/1e6).toFixed(0)}M`})},reset:()=>{e([]),u.saveOwnedPlayerIds([]),p.reset()}}}const O=F(),$=M([O,h,p],([n,a,e])=>a.filter(r=>n.includes(r.id)).map(r=>({...r,clause:e[r.id]||r.price}))),x=M([O,h],([n,a])=>a.filter(e=>!n.includes(e.id))),J=h;export{O as a,J as b,x as c,w as l,$ as o,_ as p,u as s,S as u};
